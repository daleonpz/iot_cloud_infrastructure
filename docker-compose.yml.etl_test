services:
  # Datalake
  # This service will be used to store the raw data (MinIO)
  docker-datalake:
    build:
      context: ./datalake
      dockerfile: Dockerfile
    container_name: my_datalake
    ports:
      - "9000:9000"
    environment:
      MINIO_ACCESS_KEY: minio
      MINIO_SECRET_KEY: minio123
    command: ["server", "/data", "--console-address", ":9001"]
    networks:
      - backend
    restart: always

  # Database
  # This service will be used to store the transformed data (Casandra)
  docker-database:
    build:
      context: ./database
      dockerfile: Dockerfile
    container_name: my_db
    ports:
      - "9042:9042"
    networks:
      - backend
    restart: always

  # Transformations
  # This service will be used to run the transformations (ETL)
  docker-transformations:
    build:
      context: ./transformations
      dockerfile: Dockerfile
    container_name: my_transformations
    volumes:
      - ./airflow/dags/modules/transformer.py:/app/transformer.py
    networks:
      - backend
    depends_on:
      - docker-database
      - docker-datalake
    command: ["python", "transformer.py"]
    restart: always

networks:
  # Backend network
  # This network will be used to connect the services
  backend:
    driver: bridge
