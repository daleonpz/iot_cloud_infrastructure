services:
  # MQTT-Broker
  docker-mqtt-broker:
    image: eclipse-mosquitto
    container_name: my_broker
    ports:
      - "1883:1883"
    networks:
      - backend
    volumes:
      - ./mqtt/mqtt.conf:/mosquitto/config/mosquitto.conf
    restart: always

  # MQTT-APP
  docker-mqtt-app:
    build:
      context: ./mqtt
      dockerfile: Dockerfile
    container_name: mqtt_app
    environment:
      MQTT_BROKER: docker-mqtt-broker
      MQTT_PORT: 1883
      MQTT_TOPIC: test/dummy_topic
      MQTT_NUM_RETRIES: 10
      MINIO_ENDPOINT: docker-datalake
      MINIO_PORT: 9000
      MINIO_ACCESS_KEY: minio
      MINIO_SECRET_KEY: minio123
      MINIO_BUCKET_NAME: test-data
      MINIO_NUM_RETRIES: 3
    networks:
      - backend
    restart: always

  # Datalake
  # This service will be used to store the raw data (MinIO)
  docker-datalake:
    build:
      context: ./datalake
      dockerfile: Dockerfile
    container_name: my_datalake
    ports:
      - "9000:9000"
    environment:
      MINIO_ACCESS_KEY: minio
      MINIO_SECRET_KEY: minio123
    command: ["server", "/data", "--console-address", ":9001"]
    networks:
      - backend
    restart: always

networks:
  # Backend network
  # This network will be used to connect the services
  backend:
    driver: bridge
